/*! angular-powerbi v1.0.0-beta.4 | (c) 2016 Microsoft Corporation MIT */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("powerbi-client"),require("angular")):"function"==typeof define&&define.amd?define(["powerbi-client","angular"],t):"object"==typeof exports?exports["angular-powerbi"]=t(require("powerbi-client"),require("angular")):e["angular-powerbi"]=t(e["powerbi-client"],e.angular)}(this,function(e,t){return function(e){function t(i){if(o[i])return o[i].exports;var r=o[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";var i=o(1),r=o(2),n=o(3);t.service=n["default"];var s=o(5);t.components={report:i["default"],component:r["default"]},s.module("powerbi.global",[]).value("PowerBiGlobal",window["powerbi-client"].service.Service),s.module("powerbi.service",["powerbi.global"]).service("PowerBiService",n["default"]),s.module("powerbi.components.powerbiReport",["powerbi.service"]).directive("powerbiReport",function(){return new i["default"]}),s.module("powerbi.components.powerbiComponent",["powerbi.service"]).directive("powerbiComponent",function(){return new r["default"]}),s.module("powerbi.components",["powerbi.components.powerbiReport","powerbi.components.powerbiComponent"]),s.module("powerbi",["powerbi.service","powerbi.components"])},function(e,t){"use strict";var o=function(){function e(e,t,o){this.$scope=e,this.$timeout=t,this.powerBiService=o}return e.prototype.init=function(e){var t=this;this.validateRequiredAttributes()&&this.embed(e);var o=this.debounce(function(){t.validateRequiredAttributes()?t.embed(e):t.component&&t.reset(e)},100);this.$scope.$watch(function(){return t.embedUrl},function(t,i){t!==i&&o(e)}),this.$scope.$watch(function(){return t.accessToken},function(t,i){t!==i&&o(e)})},e.prototype.embed=function(e){var t={type:"report",embedUrl:this.embedUrl,accessToken:this.accessToken,id:this.reportId,uniqueId:this.name};angular.extend(t,this.options),this.component=this.powerBiService.embed(e,t)},e.prototype.reset=function(e){this.powerBiService.reset(e),this.component=null},e.prototype.debounce=function(e,t){var o,i=this;return function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];o&&i.$timeout.cancel(o),o=i.$timeout(function(){return e.apply(void 0,r)},t)}},e.prototype.validateRequiredAttributes=function(){return"string"==typeof this.embedUrl&&this.embedUrl.length>0&&"string"==typeof this.accessToken&&this.accessToken.length>0},e.$inject=["$scope","$timeout","PowerBiService"],e}();t.Controller=o;var i=function(){function e(){this.restrict="E",this.replace=!0,this.template='<div class="powerbi-frame"></div>',this.scope={accessToken:"=",embedUrl:"=",reportId:"=?",name:"=?",options:"=?"},this.controller=o,this.bindToController=!0,this.controllerAs="vm"}return e.prototype.link=function(e,t,o,i,r){i.init(t[0]),e.$on("$destroy",function(){i.reset(t[0])})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i},function(e,t){"use strict";var o=function(){function e(e,t){this.$scope=e,this.powerBiService=t,this.validationMap={report:this.validateReportOptions}}return e.prototype.init=function(e){var t=this;this.validateOptions(this.options)&&this.embed(e,this.options),this.$scope.$watch(function(){return t.options},function(o,i){o!==i&&(t.validateOptions(t.options)?t.embed(e,t.options):t.component&&t.reset(e))},!0)},e.prototype.embed=function(e,t){this.component=this.powerBiService.embed(e,t)},e.prototype.reset=function(e){this.powerBiService.reset(e),this.component=null},e.prototype.validateOptions=function(e){return this.options&&"string"==typeof e.embedUrl&&e.embedUrl.length>0&&"string"==typeof e.accessToken&&e.accessToken.length>0&&this.validationMap.hasOwnProperty(e.type)&&"function"==typeof this.validationMap[e.type]?this.validationMap[e.type](e):!1},e.prototype.validateReportOptions=function(e){return!0},e.$inject=["$scope","PowerBiService"],e}();t.Controller=o;var i=function(){function e(){this.restrict="E",this.replace=!0,this.template='<div class="powerbi-frame"></div>',this.scope={accessToken:"=",embedUrl:"=",options:"=?"},this.controller=o,this.bindToController=!0,this.controllerAs="vm"}return e.prototype.link=function(e,t,o,i,r){i.init(t[0]),e.$on("$destroy",function(){i.reset(t[0])})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i},function(e,t,o){"use strict";var i=o(4),r=function(){function e(e){this.powerBiCoreService=new e(i.factories.hpmFactory,i.factories.wpmpFactory,i.factories.routerFactory)}return e.prototype.embed=function(e,t){return this.powerBiCoreService.embed(e,t)},e.prototype.reset=function(e){this.powerBiCoreService.reset(e)},e.$inject=["PowerBiGlobal"],e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r},function(t,o){t.exports=e},function(e,o){e.exports=t}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItcG93ZXJiaS5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJyZXF1aXJlIiwiZGVmaW5lIiwiYW1kIiwidGhpcyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV81X18iLCJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsImNvbXBvbmVudF8xIiwiY29tcG9uZW50XzIiLCJwb3dlcmJpXzEiLCJzZXJ2aWNlIiwiYW5ndWxhciIsImNvbXBvbmVudHMiLCJyZXBvcnQiLCJjb21wb25lbnQiLCJ2YWx1ZSIsIndpbmRvdyIsIlNlcnZpY2UiLCJkaXJlY3RpdmUiLCJDb250cm9sbGVyIiwiJHNjb3BlIiwiJHRpbWVvdXQiLCJwb3dlckJpU2VydmljZSIsInByb3RvdHlwZSIsImluaXQiLCJlbGVtZW50IiwiX3RoaXMiLCJ2YWxpZGF0ZVJlcXVpcmVkQXR0cmlidXRlcyIsImVtYmVkIiwiZGVib3VuY2VkRW1iZWQiLCJkZWJvdW5jZSIsInJlc2V0IiwiJHdhdGNoIiwiZW1iZWRVcmwiLCJvbGRFbWJlZFVybCIsImFjY2Vzc1Rva2VuIiwib2xkQWNjZXNzVG9rZW4iLCJjb25maWciLCJ0eXBlIiwicmVwb3J0SWQiLCJ1bmlxdWVJZCIsIm5hbWUiLCJleHRlbmQiLCJvcHRpb25zIiwiZnVuYyIsIndhaXQiLCJwcmV2aW91c1RpbWVvdXRQcm9taXNlIiwiYXJncyIsIl9pIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiY2FuY2VsIiwiYXBwbHkiLCIkaW5qZWN0IiwiRGlyZWN0aXZlIiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGUiLCJzY29wZSIsImNvbnRyb2xsZXIiLCJiaW5kVG9Db250cm9sbGVyIiwiY29udHJvbGxlckFzIiwibGluayIsImF0dHJpYnV0ZXMiLCJ0cmFuc2NsdWRlRm4iLCIkb24iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbGlkYXRpb25NYXAiLCJ2YWxpZGF0ZVJlcG9ydE9wdGlvbnMiLCJ2YWxpZGF0ZU9wdGlvbnMiLCJvbGRPcHRpb25zIiwiaGFzT3duUHJvcGVydHkiLCJwYmkiLCJQb3dlckJpU2VydmljZSIsIlBvd2VyQmkiLCJwb3dlckJpQ29yZVNlcnZpY2UiLCJmYWN0b3JpZXMiLCJocG1GYWN0b3J5Iiwid3BtcEZhY3RvcnkiLCJyb3V0ZXJGYWN0b3J5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUEyQ0EsRUFBTUMsR0FDMUIsZ0JBQVpDLFVBQTBDLGdCQUFYQyxRQUN4Q0EsT0FBT0QsUUFBVUQsRUFBUUcsUUFBUSxrQkFBbUJBLFFBQVEsWUFDbkMsa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUM5Q0QsUUFBUSxpQkFBa0IsV0FBWUosR0FDWixnQkFBWkMsU0FDZEEsUUFBUSxtQkFBcUJELEVBQVFHLFFBQVEsa0JBQW1CQSxRQUFRLFlBRXhFSixFQUFLLG1CQUFxQkMsRUFBUUQsRUFBSyxrQkFBbUJBLEVBQWMsVUFDdkVPLEtBQU0sU0FBU0MsRUFBK0JDLEdBQ2pELE1BQWdCLFVBQVVDLEdBS2hCLFFBQVNDLEdBQW9CQyxHQUc1QixHQUFHQyxFQUFpQkQsR0FDbkIsTUFBT0MsR0FBaUJELEdBQVVWLE9BR25DLElBQUlDLEdBQVNVLEVBQWlCRCxJQUM3QlYsV0FDQVksR0FBSUYsRUFDSkcsUUFBUSxFQVVULE9BTkFMLEdBQVFFLEdBQVVJLEtBQUtiLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNTLEdBRy9EUixFQUFPWSxRQUFTLEVBR1RaLEVBQU9ELFFBdkJmLEdBQUlXLEtBcUNKLE9BVEFGLEdBQW9CTSxFQUFJUCxFQUd4QkMsRUFBb0JPLEVBQUlMLEVBR3hCRixFQUFvQlEsRUFBSSxHQUdqQlIsRUFBb0IsS0FLL0IsU0FBU1IsRUFBUUQsRUFBU1MsR0FFL0IsWUFDQSxJQUFJUyxHQUFj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QUFJSSxVQUFVRSxZQUFhTixFQUFJSSxVQUFVRyxlQVc3RyxNQVRBTixHQUFlbkQsVUFBVUssTUFBUSxTQUFVSCxFQUFTWSxHQUNoRCxNQUFPM0MsTUFBS2tGLG1CQUFtQmhELE1BQU1ILEVBQVNZLElBRWxEcUMsRUFBZW5ELFVBQVVRLE1BQVEsU0FBVU4sR0FDdkMvQixLQUFLa0YsbUJBQW1CN0MsTUFBTU4sSUFFbENpRCxFQUFlckIsU0FDWCxpQkFFR3FCLElBRVhSLFFBQU9DLGVBQWU5RSxFQUFTLGNBQWdCMEIsT0FBTyxJQUN0RDFCLEVBQUFBLFdBQWtCcUYsR0FLYixTQUFTcEYsRUFBUUQsR0FFdEJDLEVBQU9ELFFBQVVNLEdBSVosU0FBU0wsRUFBUUQsR0FFdEJDLEVBQU9ELFFBQVVPIiwiZmlsZSI6ImFuZ3VsYXItcG93ZXJiaS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInBvd2VyYmktY2xpZW50XCIpLCByZXF1aXJlKFwiYW5ndWxhclwiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXCJwb3dlcmJpLWNsaWVudFwiLCBcImFuZ3VsYXJcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiYW5ndWxhci1wb3dlcmJpXCJdID0gZmFjdG9yeShyZXF1aXJlKFwicG93ZXJiaS1jbGllbnRcIiksIHJlcXVpcmUoXCJhbmd1bGFyXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJhbmd1bGFyLXBvd2VyYmlcIl0gPSBmYWN0b3J5KHJvb3RbXCJwb3dlcmJpLWNsaWVudFwiXSwgcm9vdFtcImFuZ3VsYXJcIl0pO1xufSkodGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNV9fKSB7XG5yZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge30sXG4vKioqKioqLyBcdFx0XHRpZDogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHRcInVzZSBzdHJpY3RcIjtcclxuXHR2YXIgY29tcG9uZW50XzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpO1xyXG5cdHZhciBjb21wb25lbnRfMiA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XHJcblx0dmFyIHBvd2VyYmlfMSA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7XHJcblx0ZXhwb3J0cy5zZXJ2aWNlID0gcG93ZXJiaV8xLmRlZmF1bHQ7XHJcblx0dmFyIGFuZ3VsYXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpO1xyXG5cdGV4cG9ydHMuY29tcG9uZW50cyA9IHtcclxuXHQgICAgcmVwb3J0OiBjb21wb25lbnRfMS5kZWZhdWx0LFxyXG5cdCAgICBjb21wb25lbnQ6IGNvbXBvbmVudF8yLmRlZmF1bHRcclxuXHR9O1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdwb3dlcmJpLmdsb2JhbCcsIFtdKVxyXG5cdCAgICAudmFsdWUoJ1Bvd2VyQmlHbG9iYWwnLCB3aW5kb3dbJ3Bvd2VyYmktY2xpZW50J10uc2VydmljZS5TZXJ2aWNlKTtcclxuXHRhbmd1bGFyLm1vZHVsZSgncG93ZXJiaS5zZXJ2aWNlJywgW1xyXG5cdCAgICAncG93ZXJiaS5nbG9iYWwnXHJcblx0XSlcclxuXHQgICAgLnNlcnZpY2UoJ1Bvd2VyQmlTZXJ2aWNlJyAvKiBzZXJ2aWNlLm5hbWUgKi8sIHBvd2VyYmlfMS5kZWZhdWx0KTtcclxuXHRhbmd1bGFyLm1vZHVsZSgncG93ZXJiaS5jb21wb25lbnRzLnBvd2VyYmlSZXBvcnQnLCBbXHJcblx0ICAgICdwb3dlcmJpLnNlcnZpY2UnXHJcblx0XSlcclxuXHQgICAgLmRpcmVjdGl2ZSgncG93ZXJiaVJlcG9ydCcgLyogcmVwb3J0RGlyZWN0aXZlLm5hbWUgKi8sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBjb21wb25lbnRfMS5kZWZhdWx0KCk7IH0pO1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdwb3dlcmJpLmNvbXBvbmVudHMucG93ZXJiaUNvbXBvbmVudCcsIFtcclxuXHQgICAgJ3Bvd2VyYmkuc2VydmljZSdcclxuXHRdKVxyXG5cdCAgICAuZGlyZWN0aXZlKCdwb3dlcmJpQ29tcG9uZW50JyAvKiBjb21wb25lbnREaXJlY3RpdmUubmFtZSAqLywgZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IGNvbXBvbmVudF8yLmRlZmF1bHQoKTsgfSk7XHJcblx0YW5ndWxhci5tb2R1bGUoJ3Bvd2VyYmkuY29tcG9uZW50cycsIFtcclxuXHQgICAgJ3Bvd2VyYmkuY29tcG9uZW50cy5wb3dlcmJpUmVwb3J0JyxcclxuXHQgICAgJ3Bvd2VyYmkuY29tcG9uZW50cy5wb3dlcmJpQ29tcG9uZW50J1xyXG5cdF0pO1xyXG5cdGFuZ3VsYXIubW9kdWxlKCdwb3dlcmJpJywgW1xyXG5cdCAgICAncG93ZXJiaS5zZXJ2aWNlJyxcclxuXHQgICAgJ3Bvd2VyYmkuY29tcG9uZW50cydcclxuXHRdKTtcclxuXG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRcInVzZSBzdHJpY3RcIjtcclxuXHR2YXIgQ29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XHJcblx0ICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgcG93ZXJCaVNlcnZpY2UpIHtcclxuXHQgICAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xyXG5cdCAgICAgICAgdGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xyXG5cdCAgICAgICAgdGhpcy5wb3dlckJpU2VydmljZSA9IHBvd2VyQmlTZXJ2aWNlO1xyXG5cdCAgICB9XHJcblx0ICAgIC8qKlxyXG5cdCAgICAgKiBIYW5kbGVyIGFmdGVyIGNvbXBvbmVudCBpcyBpbnNlcnRlZCBpbiB0aGUgRE9NLiBJZiByZXF1aXJlZCBhdHRyaWJ1dGVzIGFyZSB2YWxpZCBlbWJlZCBpbW1lZGlhdGVseVxyXG5cdCAgICAgKiBvdGhlcndpc2UsIHdhdGNoIGF0dHJpYnV0ZXMgYW5kIGVtYmVkIHdoZW4gdGhleSBhcmUgdmFsaWQuXHJcblx0ICAgICAqL1xyXG5cdCAgICBDb250cm9sbGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuXHQgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcblx0ICAgICAgICBpZiAodGhpcy52YWxpZGF0ZVJlcXVpcmVkQXR0cmlidXRlcygpKSB7XHJcblx0ICAgICAgICAgICAgdGhpcy5lbWJlZChlbGVtZW50KTtcclxuXHQgICAgICAgIH1cclxuXHQgICAgICAgIC8vIFRPRE86IExvb2sgZm9yIGFub3RoZXIgd2F5IHRvIGVuc3VyZSBib3RoIGF0dHJpYnV0ZXMgaGF2ZSBjaGFuZ2VkIGJlZm9yZSBjYWxsaW5nIHRoaXMuZW1iZWQuXHJcblx0ICAgICAgICAvLyBJbiBtb3N0IGNhc2VzIGVtYmVkVXJsIGFuZCBhY2Nlc3NUb2tlbiB3aWxsIGJlIHVwZGF0ZWQgYXQgdGhlIHNhbWUgdGltZSwgYnV0IHRoaXMgdGFrZXMgdHdvIGN5Y2xlc1xyXG5cdCAgICAgICAgLy8gZm9yIHRoZSBjaGFuZ2VzIHRvIHByb3BlZ2F0ZSBmcm9tIHRoZSBwYXJlbnQgJHNjb3BlIHRvIHRoaXMgJHNjb3BlLlxyXG5cdCAgICAgICAgLy8gcGVyaGFwcyB3ZSBjYW4ganVzdCB1c2UgJHRpbWVvdXQoKSBkaXJlY3RseS4gXHJcblx0ICAgICAgICB2YXIgZGVib3VuY2VkRW1iZWQgPSB0aGlzLmRlYm91bmNlKGZ1bmN0aW9uICgpIHtcclxuXHQgICAgICAgICAgICBpZiAoX3RoaXMudmFsaWRhdGVSZXF1aXJlZEF0dHJpYnV0ZXMoKSkge1xyXG5cdCAgICAgICAgICAgICAgICBfdGhpcy5lbWJlZChlbGVtZW50KTtcclxuXHQgICAgICAgICAgICB9XHJcblx0ICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMuY29tcG9uZW50KSB7XHJcblx0ICAgICAgICAgICAgICAgIF90aGlzLnJlc2V0KGVsZW1lbnQpO1xyXG5cdCAgICAgICAgICAgIH1cclxuXHQgICAgICAgIH0sIDEwMCk7XHJcblx0ICAgICAgICB0aGlzLiRzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuZW1iZWRVcmw7IH0sIGZ1bmN0aW9uIChlbWJlZFVybCwgb2xkRW1iZWRVcmwpIHtcclxuXHQgICAgICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IGluaXRpYWxpemF0aW9uXHJcblx0ICAgICAgICAgICAgaWYgKGVtYmVkVXJsID09PSBvbGRFbWJlZFVybCkge1xyXG5cdCAgICAgICAgICAgICAgICByZXR1cm47XHJcblx0ICAgICAgICAgICAgfVxyXG5cdCAgICAgICAgICAgIGRlYm91bmNlZEVtYmVkKGVsZW1lbnQpO1xyXG5cdCAgICAgICAgfSk7XHJcblx0ICAgICAgICB0aGlzLiRzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuYWNjZXNzVG9rZW47IH0sIGZ1bmN0aW9uIChhY2Nlc3NUb2tlbiwgb2xkQWNjZXNzVG9rZW4pIHtcclxuXHQgICAgICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IGluaXRpYWxpemF0aW9uXHJcblx0ICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuID09PSBvbGRBY2Nlc3NUb2tlbikge1xyXG5cdCAgICAgICAgICAgICAgICByZXR1cm47XHJcblx0ICAgICAgICAgICAgfVxyXG5cdCAgICAgICAgICAgIGRlYm91bmNlZEVtYmVkKGVsZW1lbnQpO1xyXG5cdCAgICAgICAgfSk7XHJcblx0ICAgIH07XHJcblx0ICAgIC8qKlxyXG5cdCAgICAgKiBHaXZlbiBhbiBIVE1MRWxlbWVudCwgY29uc3RydWN0IGFuIGVtYmVkIGNvbmZpZ3VyYXRpb24gYmFzZWQgb24gYXR0cmlidXRlcyBhbmQgcGFzcyB0byBzZXJ2aWNlLlxyXG5cdCAgICAgKi9cclxuXHQgICAgQ29udHJvbGxlci5wcm90b3R5cGUuZW1iZWQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG5cdCAgICAgICAgdmFyIGNvbmZpZyA9IHtcclxuXHQgICAgICAgICAgICB0eXBlOiAncmVwb3J0JyxcclxuXHQgICAgICAgICAgICBlbWJlZFVybDogdGhpcy5lbWJlZFVybCxcclxuXHQgICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbixcclxuXHQgICAgICAgICAgICBpZDogdGhpcy5yZXBvcnRJZCxcclxuXHQgICAgICAgICAgICB1bmlxdWVJZDogdGhpcy5uYW1lXHJcblx0ICAgICAgICB9O1xyXG5cdCAgICAgICAgYW5ndWxhci5leHRlbmQoY29uZmlnLCB0aGlzLm9wdGlvbnMpO1xyXG5cdCAgICAgICAgdGhpcy5jb21wb25lbnQgPSB0aGlzLnBvd2VyQmlTZXJ2aWNlLmVtYmVkKGVsZW1lbnQsIGNvbmZpZyk7XHJcblx0ICAgIH07XHJcblx0ICAgIC8qKlxyXG5cdCAgICAgKiBIYW5kbGVyIHdoZW4gY29tcG9uZW50IGlzIHJlbW92ZWQgZnJvbSBET00uIEZvcndhcmRzIGNhbGwgdG8gc2VydmljZSB0byBwZXJmb3JtIGNsZWFudXAgb2YgcmVmZXJlbmNlcyBiZWZvcmUgRE9NIGlzIG1vZGlmaWVkLlxyXG5cdCAgICAgKi9cclxuXHQgICAgQ29udHJvbGxlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG5cdCAgICAgICAgdGhpcy5wb3dlckJpU2VydmljZS5yZXNldChlbGVtZW50KTtcclxuXHQgICAgICAgIHRoaXMuY29tcG9uZW50ID0gbnVsbDtcclxuXHQgICAgfTtcclxuXHQgICAgQ29udHJvbGxlci5wcm90b3R5cGUuZGVib3VuY2UgPSBmdW5jdGlvbiAoZnVuYywgd2FpdCkge1xyXG5cdCAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuXHQgICAgICAgIHZhciBwcmV2aW91c1RpbWVvdXRQcm9taXNlO1xyXG5cdCAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuXHQgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xyXG5cdCAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcblx0ICAgICAgICAgICAgICAgIGFyZ3NbX2kgLSAwXSA9IGFyZ3VtZW50c1tfaV07XHJcblx0ICAgICAgICAgICAgfVxyXG5cdCAgICAgICAgICAgIGlmIChwcmV2aW91c1RpbWVvdXRQcm9taXNlKSB7XHJcblx0ICAgICAgICAgICAgICAgIF90aGlzLiR0aW1lb3V0LmNhbmNlbChwcmV2aW91c1RpbWVvdXRQcm9taXNlKTtcclxuXHQgICAgICAgICAgICB9XHJcblx0ICAgICAgICAgICAgcHJldmlvdXNUaW1lb3V0UHJvbWlzZSA9IF90aGlzLiR0aW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmMuYXBwbHkodm9pZCAwLCBhcmdzKTsgfSwgd2FpdCk7XHJcblx0ICAgICAgICB9O1xyXG5cdCAgICB9O1xyXG5cdCAgICAvKipcclxuXHQgICAgICogRW5zdXJlIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGVtYmVkVXJsIGFuZCBhY2Nlc3NUb2tlbiBhcmUgdmFsaWQgYmVmb3JlIGF0dGVtcHRpbmcgdG8gZW1iZWQpXHJcblx0ICAgICAqL1xyXG5cdCAgICBDb250cm9sbGVyLnByb3RvdHlwZS52YWxpZGF0ZVJlcXVpcmVkQXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHtcclxuXHQgICAgICAgIHJldHVybiAodHlwZW9mIHRoaXMuZW1iZWRVcmwgPT09ICdzdHJpbmcnICYmIHRoaXMuZW1iZWRVcmwubGVuZ3RoID4gMClcclxuXHQgICAgICAgICAgICAmJiAodHlwZW9mIHRoaXMuYWNjZXNzVG9rZW4gPT09ICdzdHJpbmcnICYmIHRoaXMuYWNjZXNzVG9rZW4ubGVuZ3RoID4gMCk7XHJcblx0ICAgIH07XHJcblx0ICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcclxuXHQgICAgICAgICckc2NvcGUnLFxyXG5cdCAgICAgICAgJyR0aW1lb3V0JyxcclxuXHQgICAgICAgICdQb3dlckJpU2VydmljZSdcclxuXHQgICAgXTtcclxuXHQgICAgcmV0dXJuIENvbnRyb2xsZXI7XHJcblx0fSgpKTtcclxuXHRleHBvcnRzLkNvbnRyb2xsZXIgPSBDb250cm9sbGVyO1xyXG5cdHZhciBEaXJlY3RpdmUgPSAoZnVuY3Rpb24gKCkge1xyXG5cdCAgICBmdW5jdGlvbiBEaXJlY3RpdmUoKSB7XHJcblx0ICAgICAgICAvLyBzdGF0aWMgbmFtZSA9IFwicG93ZXJiaVJlcG9ydFwiO1xyXG5cdCAgICAgICAgdGhpcy5yZXN0cmljdCA9IFwiRVwiO1xyXG5cdCAgICAgICAgdGhpcy5yZXBsYWNlID0gdHJ1ZTtcclxuXHQgICAgICAgIHRoaXMudGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cInBvd2VyYmktZnJhbWVcIj48L2Rpdj4nO1xyXG5cdCAgICAgICAgdGhpcy5zY29wZSA9IHtcclxuXHQgICAgICAgICAgICBhY2Nlc3NUb2tlbjogXCI9XCIsXHJcblx0ICAgICAgICAgICAgZW1iZWRVcmw6IFwiPVwiLFxyXG5cdCAgICAgICAgICAgIHJlcG9ydElkOiBcIj0/XCIsXHJcblx0ICAgICAgICAgICAgbmFtZTogXCI9P1wiLFxyXG5cdCAgICAgICAgICAgIG9wdGlvbnM6IFwiPT9cIlxyXG5cdCAgICAgICAgfTtcclxuXHQgICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbnRyb2xsZXI7XHJcblx0ICAgICAgICB0aGlzLmJpbmRUb0NvbnRyb2xsZXIgPSB0cnVlO1xyXG5cdCAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSBcInZtXCI7XHJcblx0ICAgIH1cclxuXHQgICAgRGlyZWN0aXZlLnByb3RvdHlwZS5saW5rID0gZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgY29udHJvbGxlciwgdHJhbnNjbHVkZUZuKSB7XHJcblx0ICAgICAgICBjb250cm9sbGVyLmluaXQoZWxlbWVudFswXSk7XHJcblx0ICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuXHQgICAgICAgICAgICBjb250cm9sbGVyLnJlc2V0KGVsZW1lbnRbMF0pO1xyXG5cdCAgICAgICAgfSk7XHJcblx0ICAgIH07XHJcblx0ICAgIHJldHVybiBEaXJlY3RpdmU7XHJcblx0fSgpKTtcclxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcblx0ZXhwb3J0cy5kZWZhdWx0ID0gRGlyZWN0aXZlO1xyXG5cblxuLyoqKi8gfSxcbi8qIDIgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdFwidXNlIHN0cmljdFwiO1xyXG5cdHZhciBDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcclxuXHQgICAgZnVuY3Rpb24gQ29udHJvbGxlcigkc2NvcGUsIHBvd2VyQmlTZXJ2aWNlKSB7XHJcblx0ICAgICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcclxuXHQgICAgICAgIHRoaXMucG93ZXJCaVNlcnZpY2UgPSBwb3dlckJpU2VydmljZTtcclxuXHQgICAgICAgIHRoaXMudmFsaWRhdGlvbk1hcCA9IHtcclxuXHQgICAgICAgICAgICAncmVwb3J0JzogdGhpcy52YWxpZGF0ZVJlcG9ydE9wdGlvbnNcclxuXHQgICAgICAgIH07XHJcblx0ICAgIH1cclxuXHQgICAgLyoqXHJcblx0ICAgICAqIEhhbmRsZXIgYWZ0ZXIgY29tcG9uZW50IGlzIGluc2VydGVkIGluIHRoZSBET00uIElmIHJlcXVpcmVkIGF0dHJpYnV0ZXMgYXJlIHZhbGlkIGVtYmVkIGltbWVkaWF0ZWx5XHJcblx0ICAgICAqIG90aGVyd2lzZSwgd2F0Y2ggYXR0cmlidXRlcyBhbmQgZW1iZWQgd2hlbiB0aGV5IGFyZSB2YWxpZC5cclxuXHQgICAgICovXHJcblx0ICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG5cdCAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuXHQgICAgICAgIGlmICh0aGlzLnZhbGlkYXRlT3B0aW9ucyh0aGlzLm9wdGlvbnMpKSB7XHJcblx0ICAgICAgICAgICAgdGhpcy5lbWJlZChlbGVtZW50LCB0aGlzLm9wdGlvbnMpO1xyXG5cdCAgICAgICAgfVxyXG5cdCAgICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLm9wdGlvbnM7IH0sIGZ1bmN0aW9uIChvcHRpb25zLCBvbGRPcHRpb25zKSB7XHJcblx0ICAgICAgICAgICAgLy8gR3VhcmQgYWdhaW5zdCBpbml0aWFsaXphdGlvblxyXG5cdCAgICAgICAgICAgIGlmIChvcHRpb25zID09PSBvbGRPcHRpb25zKSB7XHJcblx0ICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHQgICAgICAgICAgICB9XHJcblx0ICAgICAgICAgICAgaWYgKF90aGlzLnZhbGlkYXRlT3B0aW9ucyhfdGhpcy5vcHRpb25zKSkge1xyXG5cdCAgICAgICAgICAgICAgICBfdGhpcy5lbWJlZChlbGVtZW50LCBfdGhpcy5vcHRpb25zKTtcclxuXHQgICAgICAgICAgICB9XHJcblx0ICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMuY29tcG9uZW50KSB7XHJcblx0ICAgICAgICAgICAgICAgIF90aGlzLnJlc2V0KGVsZW1lbnQpO1xyXG5cdCAgICAgICAgICAgIH1cclxuXHQgICAgICAgIH0sIHRydWUpO1xyXG5cdCAgICB9O1xyXG5cdCAgICAvKipcclxuXHQgICAgICogR2l2ZW4gYW4gSFRNTEVsZW1lbnQsIGNvbnN0cnVjdCBhbiBlbWJlZCBjb25maWd1cmF0aW9uIGJhc2VkIG9uIGF0dHJpYnV0ZXMgYW5kIHBhc3MgdG8gc2VydmljZS5cclxuXHQgICAgICovXHJcblx0ICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmVtYmVkID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuXHQgICAgICAgIHRoaXMuY29tcG9uZW50ID0gdGhpcy5wb3dlckJpU2VydmljZS5lbWJlZChlbGVtZW50LCBvcHRpb25zKTtcclxuXHQgICAgfTtcclxuXHQgICAgLyoqXHJcblx0ICAgICAqIEhhbmRsZXIgd2hlbiBjb21wb25lbnQgaXMgcmVtb3ZlZCBmcm9tIERPTS4gRm9yd2FyZHMgY2FsbCB0byBzZXJ2aWNlIHRvIHBlcmZvcm0gY2xlYW51cCBvZiByZWZlcmVuY2VzIGJlZm9yZSBET00gaXMgbW9kaWZpZWQuXHJcblx0ICAgICAqL1xyXG5cdCAgICBDb250cm9sbGVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcblx0ICAgICAgICB0aGlzLnBvd2VyQmlTZXJ2aWNlLnJlc2V0KGVsZW1lbnQpO1xyXG5cdCAgICAgICAgdGhpcy5jb21wb25lbnQgPSBudWxsO1xyXG5cdCAgICB9O1xyXG5cdCAgICAvKipcclxuXHQgICAgICogRW5zdXJlIHJlcXVpcmVkIG9wdGlvbnMgKGVtYmVkVXJsIGFuZCBhY2Nlc3NUb2tlbiBhcmUgdmFsaWQgYmVmb3JlIGF0dGVtcHRpbmcgdG8gZW1iZWQpXHJcblx0ICAgICAqL1xyXG5cdCAgICBDb250cm9sbGVyLnByb3RvdHlwZS52YWxpZGF0ZU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cdCAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnNcclxuXHQgICAgICAgICAgICB8fCAhKHR5cGVvZiBvcHRpb25zLmVtYmVkVXJsID09PSAnc3RyaW5nJyAmJiBvcHRpb25zLmVtYmVkVXJsLmxlbmd0aCA+IDApXHJcblx0ICAgICAgICAgICAgfHwgISh0eXBlb2Ygb3B0aW9ucy5hY2Nlc3NUb2tlbiA9PT0gJ3N0cmluZycgJiYgb3B0aW9ucy5hY2Nlc3NUb2tlbi5sZW5ndGggPiAwKSkge1xyXG5cdCAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHQgICAgICAgIH1cclxuXHQgICAgICAgIGlmICh0aGlzLnZhbGlkYXRpb25NYXAuaGFzT3duUHJvcGVydHkob3B0aW9ucy50eXBlKSAmJiB0eXBlb2YgdGhpcy52YWxpZGF0aW9uTWFwW29wdGlvbnMudHlwZV0gPT09IFwiZnVuY3Rpb25cIikge1xyXG5cdCAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRpb25NYXBbb3B0aW9ucy50eXBlXShvcHRpb25zKTtcclxuXHQgICAgICAgIH1cclxuXHQgICAgICAgIGVsc2Uge1xyXG5cdCAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHQgICAgICAgIH1cclxuXHQgICAgfTtcclxuXHQgICAgQ29udHJvbGxlci5wcm90b3R5cGUudmFsaWRhdGVSZXBvcnRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuXHQgICAgICAgIHJldHVybiB0cnVlO1xyXG5cdCAgICB9O1xyXG5cdCAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbXHJcblx0ICAgICAgICAnJHNjb3BlJyxcclxuXHQgICAgICAgICdQb3dlckJpU2VydmljZSdcclxuXHQgICAgXTtcclxuXHQgICAgcmV0dXJuIENvbnRyb2xsZXI7XHJcblx0fSgpKTtcclxuXHRleHBvcnRzLkNvbnRyb2xsZXIgPSBDb250cm9sbGVyO1xyXG5cdHZhciBEaXJlY3RpdmUgPSAoZnVuY3Rpb24gKCkge1xyXG5cdCAgICBmdW5jdGlvbiBEaXJlY3RpdmUoKSB7XHJcblx0ICAgICAgICAvLyBzdGF0aWMgbmFtZSA9IFwicG93ZXJiaUNvbXBvbmVudFwiO1xyXG5cdCAgICAgICAgdGhpcy5yZXN0cmljdCA9IFwiRVwiO1xyXG5cdCAgICAgICAgdGhpcy5yZXBsYWNlID0gdHJ1ZTtcclxuXHQgICAgICAgIHRoaXMudGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cInBvd2VyYmktZnJhbWVcIj48L2Rpdj4nO1xyXG5cdCAgICAgICAgdGhpcy5zY29wZSA9IHtcclxuXHQgICAgICAgICAgICBhY2Nlc3NUb2tlbjogXCI9XCIsXHJcblx0ICAgICAgICAgICAgZW1iZWRVcmw6IFwiPVwiLFxyXG5cdCAgICAgICAgICAgIG9wdGlvbnM6IFwiPT9cIlxyXG5cdCAgICAgICAgfTtcclxuXHQgICAgICAgIHRoaXMuY29udHJvbGxlciA9IENvbnRyb2xsZXI7XHJcblx0ICAgICAgICB0aGlzLmJpbmRUb0NvbnRyb2xsZXIgPSB0cnVlO1xyXG5cdCAgICAgICAgdGhpcy5jb250cm9sbGVyQXMgPSBcInZtXCI7XHJcblx0ICAgIH1cclxuXHQgICAgRGlyZWN0aXZlLnByb3RvdHlwZS5saW5rID0gZnVuY3Rpb24gKCRzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgY29udHJvbGxlciwgdHJhbnNjbHVkZUZuKSB7XHJcblx0ICAgICAgICBjb250cm9sbGVyLmluaXQoZWxlbWVudFswXSk7XHJcblx0ICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuXHQgICAgICAgICAgICBjb250cm9sbGVyLnJlc2V0KGVsZW1lbnRbMF0pO1xyXG5cdCAgICAgICAgfSk7XHJcblx0ICAgIH07XHJcblx0ICAgIHJldHVybiBEaXJlY3RpdmU7XHJcblx0fSgpKTtcclxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcblx0ZXhwb3J0cy5kZWZhdWx0ID0gRGlyZWN0aXZlO1xyXG5cblxuLyoqKi8gfSxcbi8qIDMgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdFwidXNlIHN0cmljdFwiO1xyXG5cdHZhciBwYmkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpO1xyXG5cdHZhciBQb3dlckJpU2VydmljZSA9IChmdW5jdGlvbiAoKSB7XHJcblx0ICAgIGZ1bmN0aW9uIFBvd2VyQmlTZXJ2aWNlKFBvd2VyQmkpIHtcclxuXHQgICAgICAgIHRoaXMucG93ZXJCaUNvcmVTZXJ2aWNlID0gbmV3IFBvd2VyQmkocGJpLmZhY3Rvcmllcy5ocG1GYWN0b3J5LCBwYmkuZmFjdG9yaWVzLndwbXBGYWN0b3J5LCBwYmkuZmFjdG9yaWVzLnJvdXRlckZhY3RvcnkpO1xyXG5cdCAgICB9XHJcblx0ICAgIFBvd2VyQmlTZXJ2aWNlLnByb3RvdHlwZS5lbWJlZCA9IGZ1bmN0aW9uIChlbGVtZW50LCBjb25maWcpIHtcclxuXHQgICAgICAgIHJldHVybiB0aGlzLnBvd2VyQmlDb3JlU2VydmljZS5lbWJlZChlbGVtZW50LCBjb25maWcpO1xyXG5cdCAgICB9O1xyXG5cdCAgICBQb3dlckJpU2VydmljZS5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG5cdCAgICAgICAgdGhpcy5wb3dlckJpQ29yZVNlcnZpY2UucmVzZXQoZWxlbWVudCk7XHJcblx0ICAgIH07XHJcblx0ICAgIFBvd2VyQmlTZXJ2aWNlLiRpbmplY3QgPSBbXHJcblx0ICAgICAgICAnUG93ZXJCaUdsb2JhbCdcclxuXHQgICAgXTtcclxuXHQgICAgcmV0dXJuIFBvd2VyQmlTZXJ2aWNlO1xyXG5cdH0oKSk7XHJcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5cdGV4cG9ydHMuZGVmYXVsdCA9IFBvd2VyQmlTZXJ2aWNlO1xyXG5cblxuLyoqKi8gfSxcbi8qIDQgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV80X187XG5cbi8qKiovIH0sXG4vKiA1ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfNV9fO1xuXG4vKioqLyB9XG4vKioqKioqLyBdKVxufSk7XG47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hbmd1bGFyLXBvd2VyYmkuanMubWFwIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
